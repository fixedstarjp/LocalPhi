# 🧪 Phi-4 Mini実装テスト手順

## 🎯 現在の実装のテスト

Chrome拡張機能として実際にPhi-4 Miniモデルが動作するかテストします。

### ✅ 事前準備完了

Chrome拡張機能の基本構造とファイルはすべて準備できています：

```
📁 /app/chrome-extension/dist/
├── ✅ manifest.json (891 bytes)
├── ✅ popup.html (10KB) 
├── ✅ popup.js (5.3MB - WebLLM統合済み)
├── ✅ background.js (6KB)
├── ✅ content.js (3KB)
└── ✅ icons/ (16/48/128px)
```

## 🚀 Chrome拡張機能インストール手順

### ステップ1: Chrome拡張機能ページを開く
1. Chromeブラウザを開く
2. アドレスバーに `chrome://extensions/` と入力
3. Enterキーを押す

### ステップ2: 開発者モードを有効化
1. 右上の「開発者モード」トグルをクリック
2. トグルが青色になることを確認

### ステップ3: 拡張機能を読み込む
1. 「パッケージ化されていない拡張機能を読み込む」をクリック
2. ファイル選択ダイアログで以下のフォルダを選択：
   ```
   /app/chrome-extension/dist
   ```
3. 「フォルダーの選択」をクリック

### ステップ4: インストール確認
✅ 拡張機能一覧に「AI Assistant - WebLLM」が表示される
✅ Chromeツールバーにアイコンが追加される

## 🔬 動作テスト手順

### テスト1: 基本起動確認
1. ツールバーのAI Assistantアイコンをクリック
2. ポップアップが表示されることを確認
3. 「モデル読み込み中...」表示を確認

### テスト2: WebGPU対応確認
1. Chromeアドレスバーに `chrome://gpu/` と入力
2. "WebGPU" の項目が "Hardware accelerated" になっていることを確認
3. もし無効の場合：
   - Chromeを最新版に更新
   - `chrome://flags/#enable-webgpu-developer-features` で機能を有効化

### テスト3: Phi-4 Miniモデル読み込み
1. 拡張機能を開く
2. 初回起動時は数分間の読み込み時間を待つ
3. 以下の状態変化を確認：
   - 🔴 「モデル読み込み中...」→ 🟢 「Phi-4 Mini 準備完了」
   - 進捗バーの表示
   - ボタンの有効化

### テスト4: チャット機能
1. 「チャット」タブでメッセージを入力
2. 送信ボタンをクリック
3. AI応答が表示されることを確認

### テスト5: 分析機能
1. 任意のウェブページを開く
2. 「分析」タブを選択
3. 「現在のページを分析する」をクリック
4. 分析結果が表示されることを確認

### テスト6: 翻訳機能
1. 英語のウェブページを開く
2. テキストを選択
3. 「翻訳」タブで「選択したテキストを翻訳する」をクリック
4. 日本語翻訳が表示されることを確認

## 🚨 予想される問題とトラブルシューティング

### 問題1: モデルが読み込まれない
**症状**: 長時間「モデル読み込み中...」のまま
**原因**: 
- Phi-4 Miniモデルが実際には利用できない
- ネットワーク接続エラー
- WebGPU非対応

**対処法**:
1. **コンソール確認**:
   - F12でデベロッパーツールを開く
   - Consoleタブでエラーメッセージを確認

2. **ネットワーク確認**:
   - Networkタブでダウンロード状況を確認
   - 403/404エラーがないかチェック

3. **WebGPU確認**:
   - `chrome://gpu/` でWebGPU状態を確認

### 問題2: "Model not found" エラー
**症状**: Phi-4 Miniモデルが見つからないエラー
**原因**: WebLLMでPhi-4 Miniが正式サポートされていない

**対処法**:
1. **フォールバックモデルに変更**:
   ```javascript
   // popup.jsで以下に変更
   this.modelId = "Phi-3-mini-4k-instruct-q4f16_1-MLC";
   ```

2. **利用可能モデルの確認**:
   コンソールで以下を実行:
   ```javascript
   import('@mlc-ai/web-llm').then(module => {
       console.log(module.prebuiltAppConfig.model_list);
   });
   ```

### 問題3: WebGPU初期化エラー
**症状**: "WebGPU is not supported" エラー
**対処法**:
1. Chromeを最新版に更新
2. ハードウェアアクセラレーションを有効化
3. Chrome Canaryを試用

### 問題4: メモリ不足エラー
**症状**: "Out of memory" エラー
**対処法**:
1. 他のタブを閉じる
2. より小さなモデルに変更
3. システムメモリを確認（推奨8GB以上）

## 📊 成功の指標

### ✅ 完全成功
- モデル読み込み完了（緑色ドット）
- チャット機能動作
- 分析・翻訳機能動作
- エラーなし

### ⚠️ 部分成功
- フォールバックモデルで動作
- 一部機能のみ動作
- パフォーマンス低下

### ❌ 失敗
- モデル読み込み失敗
- WebGPUエラー
- 機能が全く動作しない

## 🔄 テスト結果に応じた次のアクション

### 完全成功の場合
🎉 **おめでとうございます！** Phi-4 Miniが正常に動作しています
- 最適化作業に進む
- 追加機能の実装を検討

### 部分成功の場合
🔧 **調整が必要** フォールバックモデルで動作
- 動作するモデルIDを記録
- 実装を更新

### 失敗の場合
🛠️ **問題の特定と修正**
- エラーログの詳細分析
- WebGPU環境の改善
- モデル選択の見直し

実際のテスト実行後、結果をお知らせください！